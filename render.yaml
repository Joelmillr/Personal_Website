services:
  - type: web
    name: personal-website
    env: node
    # Explicitly set Node.js version for consistency
    nodeVersion: 18.17.0
    # Optimize build: use production mode for faster builds
    # Note: npm ci requires exact package-lock.json match; falls back to npm install if needed
    buildCommand: NODE_ENV=production npm install && npm run preprocess
    # Optimize runtime: set memory limit (512MB is Render free tier max)
    # Node.js will automatically optimize for production when NODE_ENV=production
    startCommand: node --max-old-space-size=512 server.js
    # Health check endpoint for faster wake-ups (Render will ping this)
    healthCheckPath: /api/health
    envVars:
      # ============================================
      # SERVER CONFIGURATION (Auto-set by Render)
      # ============================================
      - key: NODE_ENV
        value: production
      # PORT is automatically set by Render - don't override
      
      # ============================================
      # WEBDISPLAY CONFIGURATION
      # ============================================
      # REQUIRED: Set these in Render dashboard after first deployment
      - key: YOUTUBE_VIDEO_ID
        sync: false  # REQUIRED: Your YouTube video ID (e.g., 6CBOZGQqOI0)
      - key: YOUTUBE_START_OFFSET
        value: 0.0  # Time offset in seconds (adjust if needed)
      - key: WS_URL
        sync: false  # REQUIRED: Your Render app URL (e.g., https://personal-website.onrender.com)
      - key: DOWNSAMPLE_FACTOR
        value: 40  # Memory optimization: increased from 20 to 30 for better performance (higher = less memory, faster processing

